import {
  require_applyDecoratedDescriptor,
  require_initializerDefineProperty,
  require_initializerWarningHelper,
  require_lazy,
  require_publishReplayLatestWhileConnected,
  require_rx
} from "./chunk-UI2AWJZP.js";
import {
  require_createClass
} from "./chunk-OXRMU63H.js";
import {
  require_interopRequireDefault,
  require_invariant
} from "./chunk-UA6MBTDI.js";
import {
  __commonJS
} from "./chunk-OL46QLBJ.js";

// node_modules/@nozbe/watermelondb/Relation/helpers.js
var require_helpers = __commonJS({
  "node_modules/@nozbe/watermelondb/Relation/helpers.js"(exports) {
    "use strict";
    exports.__esModule = true;
    exports.createObservable = void 0;
    var _rx = require_rx();
    var getImmutableObservable = function(relation) {
      return relation._model.collections.get(relation._relationTableName).findAndObserve(relation.id);
    };
    var getObservable = function(relation) {
      return relation._model.observe().pipe((0, _rx.map)(function(model) {
        return model._getRaw(relation._columnName);
      }), (0, _rx.distinctUntilChanged)(), (0, _rx.switchMap)(function(id) {
        return id ? relation._model.collections.get(relation._relationTableName).findAndObserve(id) : (0, _rx.of)(null);
      }));
    };
    var createObservable = exports.createObservable = function(relation) {
      return relation._isImmutable ? getImmutableObservable(relation) : getObservable(relation);
    };
  }
});

// node_modules/@nozbe/watermelondb/Relation/index.js
var require_Relation = __commonJS({
  "node_modules/@nozbe/watermelondb/Relation/index.js"(exports) {
    "use strict";
    var _interopRequireDefault = require_interopRequireDefault();
    exports.__esModule = true;
    exports.default = void 0;
    var _initializerDefineProperty2 = _interopRequireDefault(require_initializerDefineProperty());
    var _createClass2 = _interopRequireDefault(require_createClass());
    var _applyDecoratedDescriptor2 = _interopRequireDefault(require_applyDecoratedDescriptor());
    var _initializerWarningHelper2 = _interopRequireDefault(require_initializerWarningHelper());
    var _invariant = _interopRequireDefault(require_invariant());
    var _publishReplayLatestWhileConnected = _interopRequireDefault(require_publishReplayLatestWhileConnected());
    var _lazy = _interopRequireDefault(require_lazy());
    var _helpers = require_helpers();
    var _class;
    var _descriptor;
    var _class2;
    var Relation = exports.default = (_class = (_class2 = (function() {
      function Relation2(model, relationTableName, columnName, options) {
        (0, _initializerDefineProperty2.default)(this, "_cachedObservable", _descriptor, this);
        this._model = model;
        this._relationTableName = relationTableName;
        this._columnName = columnName;
        this._isImmutable = options.isImmutable;
      }
      var _proto = Relation2.prototype;
      _proto.fetch = function() {
        var {
          id
        } = this;
        if (id) {
          return this._model.collections.get(this._relationTableName).find(id);
        }
        return Promise.resolve(null);
      };
      _proto.then = function(onFulfill, onReject) {
        return this.fetch().then(onFulfill, onReject);
      };
      _proto.set = function(record) {
        this.id = null === record || void 0 === record ? void 0 : record.id;
      };
      _proto.observe = function() {
        return this._cachedObservable;
      };
      return (0, _createClass2.default)(Relation2, [{
        key: "id",
        get: function get() {
          return this._model._getRaw(this._columnName);
        },
        set: function set(newId) {
          if (this._isImmutable) {
            (0, _invariant.default)("create" === this._model._preparedState, "Cannot change property marked as @immutableRelation ".concat(Object.getPrototypeOf(this._model).constructor.name, " - ").concat(this._columnName));
          }
          this._model._setRaw(this._columnName, newId || null);
        }
      }]);
    })(), _class2._wmelonTag = "relation", _class2), _descriptor = (0, _applyDecoratedDescriptor2.default)(_class.prototype, "_cachedObservable", [_lazy.default], {
      configurable: true,
      enumerable: true,
      writable: true,
      initializer: function initializer() {
        return (0, _helpers.createObservable)(this).pipe(_publishReplayLatestWhileConnected.default).refCount();
      }
    }), _class);
  }
});

export {
  require_Relation
};
//# sourceMappingURL=chunk-34UZUV7I.js.map
