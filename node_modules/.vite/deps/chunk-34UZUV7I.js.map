{
  "version": 3,
  "sources": ["../../@nozbe/watermelondb/Relation/helpers.js", "../../@nozbe/watermelondb/Relation/index.js"],
  "sourcesContent": ["\"use strict\";\n\nexports.__esModule = true;\nexports.createObservable = void 0;\nvar _rx = require(\"../utils/rx\");\nvar getImmutableObservable = function (relation) {\n  return relation._model.collections.get(relation._relationTableName)\n  // $FlowFixMe\n  .findAndObserve(relation.id);\n};\nvar getObservable = function (relation) {\n  return relation._model.observe()\n  // $FlowFixMe\n  .pipe((0, _rx.map)(function (model) {\n    return model._getRaw(relation._columnName);\n  }), (0, _rx.distinctUntilChanged)(), (0, _rx.switchMap)(function (id) {\n    return id ? relation._model.collections.get(relation._relationTableName).findAndObserve(id) : (0, _rx.of)(null);\n  }));\n};\n\n// eslint-disable-next-line\nvar createObservable = exports.createObservable = function (relation) {\n  return relation._isImmutable ? getImmutableObservable(relation) : getObservable(relation);\n};", "\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports.default = void 0;\nvar _initializerDefineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/initializerDefineProperty\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _applyDecoratedDescriptor2 = _interopRequireDefault(require(\"@babel/runtime/helpers/applyDecoratedDescriptor\"));\nvar _initializerWarningHelper2 = _interopRequireDefault(require(\"@babel/runtime/helpers/initializerWarningHelper\"));\nvar _invariant = _interopRequireDefault(require(\"../utils/common/invariant\"));\nvar _publishReplayLatestWhileConnected = _interopRequireDefault(require(\"../utils/rx/publishReplayLatestWhileConnected\"));\nvar _lazy = _interopRequireDefault(require(\"../decorators/lazy\"));\nvar _helpers = require(\"./helpers\");\nvar _class, _descriptor, _class2;\n// Defines a one-to-one relation between two Models (two tables in db)\n// Do not create this object directly! Use `relation` or `immutableRelation` decorators instead\nvar Relation = exports.default = (_class = (_class2 = /*#__PURE__*/function () {\n  // Used by withObservables to differentiate between object types\n\n  function Relation(model, relationTableName, columnName, options) {\n    (0, _initializerDefineProperty2.default)(this, \"_cachedObservable\", _descriptor, this);\n    this._model = model;\n    this._relationTableName = relationTableName;\n    this._columnName = columnName;\n    this._isImmutable = options.isImmutable;\n  }\n  var _proto = Relation.prototype;\n  _proto.fetch = function () {\n    var {\n      id: id\n    } = this;\n    if (id) {\n      return this._model.collections.get(this._relationTableName).find(id);\n    }\n    return Promise.resolve(null);\n  };\n  _proto.then = function (onFulfill, onReject) {\n    // $FlowFixMe\n    return this.fetch().then(onFulfill, onReject);\n  };\n  _proto.set = function (record) {\n    this.id = null === record || void 0 === record ? void 0 : record.id;\n  };\n  _proto.observe = function () {\n    return this._cachedObservable;\n  };\n  return (0, _createClass2.default)(Relation, [{\n    key: \"id\",\n    get: function get() {\n      return this._model._getRaw(this._columnName);\n    },\n    set: function set(newId) {\n      if (this._isImmutable) {\n        (0, _invariant.default)('create' === this._model._preparedState, \"Cannot change property marked as @immutableRelation \".concat(Object.getPrototypeOf(this._model).constructor.name, \" - \").concat(this._columnName));\n      }\n      this._model._setRaw(this._columnName, newId || null);\n    }\n  }]);\n}(), _class2._wmelonTag = 'relation', _class2), _descriptor = (0, _applyDecoratedDescriptor2.default)(_class.prototype, \"_cachedObservable\", [_lazy.default], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return (0, _helpers.createObservable)(this).pipe(_publishReplayLatestWhileConnected.default).refCount();\n  }\n}), _class);"],
  "mappings": "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",
  "names": ["Relation"]
}
